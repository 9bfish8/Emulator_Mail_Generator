<!DOCTYPE html>
<html lang="ko">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>QA ë©”ì¼ í…œí”Œë¦¿ ìƒì„±ê¸°</title>
  <style>
    * { box-sizing: border-box; margin: 0; padding: 0; }

    body {
      font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
      min-height: 100vh;
      background: linear-gradient(135deg, #1e293b 0%, #0f172a 50%, #1e293b 100%);
      color: white;
    }

    header {
      border-bottom: 1px solid rgba(71, 85, 105, 0.5);
      backdrop-filter: blur(8px);
      background: rgba(15, 23, 42, 0.8);
      position: sticky;
      top: 0;
      z-index: 10;
    }

    .header-content {
      max-width: 1200px;
      margin: 0 auto;
      padding: 16px 24px;
      display: flex;
      justify-content: space-between;
      align-items: center;
      flex-wrap: wrap;
      gap: 16px;
    }

    .header-title { font-size: 24px; font-weight: bold; }
    .header-subtitle { color: #94a3b8; font-size: 14px; margin-top: 4px; }
    .header-actions { display: flex; align-items: center; gap: 12px; flex-wrap: wrap; }

    input, select, textarea {
      background: #1e293b;
      border: 1px solid #475569;
      border-radius: 8px;
      padding: 8px 12px;
      color: white;
      font-size: 14px;
      outline: none;
    }

    input:focus, select:focus, textarea:focus { border-color: #f59e0b; }

    button {
      padding: 10px 20px;
      border-radius: 8px;
      font-weight: 600;
      font-size: 14px;
      border: none;
      cursor: pointer;
      transition: all 0.2s;
    }

    .btn-primary {
      background: linear-gradient(135deg, #f59e0b, #ea580c);
      color: white;
      box-shadow: 0 4px 14px rgba(234, 88, 12, 0.4);
    }

    .btn-primary:hover { transform: translateY(-1px); box-shadow: 0 6px 20px rgba(234, 88, 12, 0.5); }
    .btn-primary.copied { background: #22c55e; box-shadow: none; }
    .btn-secondary { background: #475569; color: white; }
    .btn-secondary:hover { background: #64748b; }
    .btn-small { padding: 8px 16px; background: #334155; color: white; }
    .btn-small:hover { background: #475569; }

    main { max-width: 1200px; margin: 0 auto; padding: 32px 24px; }
    section { margin-bottom: 32px; }
    h2 { font-size: 18px; font-weight: 600; margin-bottom: 16px; }

    .game-controls { display: flex; align-items: center; gap: 16px; margin-bottom: 16px; flex-wrap: wrap; }
    .game-inputs { display: flex; align-items: center; gap: 8px; flex: 1; flex-wrap: wrap; }
    .game-list { display: flex; flex-wrap: wrap; gap: 8px; }

    .game-tag {
      display: flex;
      align-items: center;
      gap: 8px;
      background: rgba(30, 41, 59, 0.5);
      border: 1px solid #334155;
      border-radius: 8px;
      padding: 8px 12px;
    }

    .game-tag input { background: transparent; border: none; padding: 0; width: 100px; }
    .game-tag .version-input { color: #fbbf24; width: 80px; }
    .game-tag span { color: #64748b; }
    .game-tag .remove-btn { color: #64748b; background: none; border: none; cursor: pointer; font-size: 18px; padding: 0; margin-left: 4px; }
    .game-tag .remove-btn:hover { color: #f87171; }

    .table-container {
      background: rgba(30, 41, 59, 0.3);
      border: 1px solid rgba(51, 65, 85, 0.5);
      border-radius: 16px;
      overflow: hidden;
    }

    .table-scroll { overflow-x: auto; }
    table { width: 100%; border-collapse: collapse; }
    thead tr { background: rgba(245, 158, 11, 0.1); border-bottom: 1px solid #334155; }
    th { padding: 12px 16px; text-align: center; color: #fbbf24; font-weight: 600; font-size: 14px; }
    th:first-child { text-align: left; }
    tbody tr { border-bottom: 1px solid rgba(51, 65, 85, 0.5); }
    tbody tr:nth-child(even) { background: rgba(30, 41, 59, 0.2); }
    td { padding: 12px 16px; font-size: 14px; }
    td:first-child { color: white; font-weight: 500; }
    td:nth-child(2) { text-align: center; color: #cbd5e1; }
    td input, td select { width: 100%; background: rgba(51, 65, 85, 0.5); text-align: center; padding: 4px 8px; border-radius: 4px; }
    td input.highlight { border-color: rgba(250, 204, 21, 0.5); color: #fde047; }
    td select.pass { color: #4ade80; }
    td select.fail { color: #f87171; font-weight: bold; }

    .preview-container {
      background: white;
      border-radius: 12px;
      padding: 24px;
      box-shadow: 0 25px 50px -12px rgba(0, 0, 0, 0.25);
      color: black;
    }

    .note-section textarea { width: 100%; min-height: 80px; resize: vertical; }
    .hidden { display: none; }

    @media (max-width: 768px) {
      .header-content { flex-direction: column; align-items: flex-start; }
      .header-actions { width: 100%; justify-content: flex-start; }
      th, td { padding: 8px; font-size: 12px; }
    }
  </style>
</head>
<body>
  <header>
    <div class="header-content">
      <div>
        <h1 class="header-title">ğŸ“§ QA ë©”ì¼ í…œí”Œë¦¿ ìƒì„±ê¸°</h1>
        <p class="header-subtitle">ì—ë®¬ë ˆì´í„° í…ŒìŠ¤íŠ¸ ê²°ê³¼ ë¦¬í¬íŠ¸</p>
      </div>
      <div class="header-actions">
        <input type="text" id="reportDate" style="width: 100px;" placeholder="ë‚ ì§œ">
        <button class="btn-secondary" onclick="togglePreview()"><span id="previewBtnText">ğŸ‘ï¸ ë¯¸ë¦¬ë³´ê¸°</span></button>
        <button class="btn-primary" id="copyBtn" onclick="copyToClipboard()">HTML ë³µì‚¬</button>
      </div>
    </div>
  </header>

  <main>
    <div id="editMode">
      <section>
        <div class="game-controls">
          <h2>ğŸ® ê²Œì„ ëª©ë¡</h2>
          <div class="game-inputs">
            <input type="text" id="newGameName" placeholder="ê²Œì„ëª…" style="width: 140px;">
            <input type="text" id="newGameVersion" placeholder="ë²„ì „" style="width: 120px;">
            <button class="btn-small" onclick="addGame()">+ ì¶”ê°€</button>
          </div>
        </div>
        <div class="game-list" id="gameList"></div>
      </section>

      <section class="table-container">
        <div class="table-scroll">
          <table>
            <thead><tr id="tableHeader"></tr></thead>
            <tbody id="tableBody"></tbody>
          </table>
        </div>
      </section>

      <section class="note-section">
        <h2>ğŸ“ ë¹„ê³  (ì„ íƒì‚¬í•­)</h2>
        <textarea id="noteText" placeholder="ì˜ˆ: * BlueStacks 5 64bit (11.0)ì—ì„œ ì•±ê°€ë“œë¥¼ ì ìš©í•œ ì•±ì˜ í¬ë˜ì‹œ ì´ìŠˆ...&#10;https://works.inca.co.kr/issues/4963"></textarea>
      </section>
    </div>

    <div id="previewMode" class="hidden">
      <section>
        <h2>ğŸ‘ï¸ Outlook ë¯¸ë¦¬ë³´ê¸°</h2>
        <div class="preview-container" id="previewContent"></div>
      </section>
    </div>
  </main>

  <script>
    const EMULATORS = [
      { id: 'bluestacks5_rooting', name: 'BlueStacks 5 64bit (ë£¨íŒ…)', android: '9.0' },
      { id: 'bluestacks5', name: 'BlueStacks 5 64bit', android: '11.0' },
      { id: 'nox_rooting', name: 'NOX 64bit (ë£¨íŒ…)', android: '9.0' },
      { id: 'nox', name: 'NOX 64bit', android: '12.0' },
      { id: 'ldplayer', name: 'LDPlayer 64bit', android: '9.0' },
      { id: 'memu_rooting', name: 'MEmu 64bit (ë£¨íŒ…)', android: '9.0' },
      { id: 'memu', name: 'MEmu 64bit', android: '12.0' },
      { id: 'mumu', name: 'MuMuPlayer 64bit', android: '12.0' },
    ];

    let versions = {};
    let games = [
      { id: 'game1', name: 'xGame', version: '1.25.2.7', results: {} },
      { id: 'game2', name: 'HeirofLight', version: '1.25.2.4', results: {} },
    ];
    let isPreviewMode = false;

    function init() {
      const params = new URLSearchParams(window.location.search);
      
      EMULATORS.forEach(emu => {
        const prev = params.get(`${emu.id}_prev`) || '';
        const latest = params.get(`${emu.id}_latest`) || '';
        versions[emu.id] = {
          prevVersion: prev || '-',
          latestVersion: latest || '-',
        };
      });

      const today = new Date();
      const dateStr = `${today.getFullYear().toString().slice(2)}${String(today.getMonth() + 1).padStart(2, '0')}${String(today.getDate()).padStart(2, '0')}`;
      document.getElementById('reportDate').value = dateStr;
      render();
    }

    function render() { renderGameList(); renderTable(); }

    function renderGameList() {
      document.getElementById('gameList').innerHTML = games.map(game => `
        <div class="game-tag">
          <input type="text" value="${game.name}" onchange="updateGame('${game.id}', 'name', this.value)">
          <span>[</span>
          <input type="text" class="version-input" value="${game.version}" onchange="updateGame('${game.id}', 'version', this.value)">
          <span>]</span>
          <button class="remove-btn" onclick="removeGame('${game.id}')">Ã—</button>
        </div>
      `).join('');
    }

    function renderTable() {
      document.getElementById('tableHeader').innerHTML = `
        <th>ì œí’ˆëª…</th>
        <th style="width: 80px;">Android</th>
        <th style="width: 130px;">ì´ì „ ë²„ì „</th>
        <th style="width: 130px;">ìµœì‹  ë²„ì „</th>
        ${games.map(g => `<th style="min-width: 90px;">${g.name}</th>`).join('')}
      `;

      document.getElementById('tableBody').innerHTML = EMULATORS.map(emu => {
        const ver = versions[emu.id] || { prevVersion: '-', latestVersion: '-' };
        const hasUpdate = ver.prevVersion !== '-' && ver.latestVersion !== '-' && ver.prevVersion !== ver.latestVersion;
        
        return `
          <tr>
            <td>${emu.name}</td>
            <td>${emu.android}</td>
            <td><input type="text" class="${hasUpdate ? 'highlight' : ''}" value="${ver.prevVersion}" onchange="updateVersion('${emu.id}', 'prevVersion', this.value)"></td>
            <td><input type="text" class="${hasUpdate ? 'highlight' : ''}" value="${ver.latestVersion}" onchange="updateVersion('${emu.id}', 'latestVersion', this.value)"></td>
            ${games.map(g => {
              const result = g.results[emu.id] || '-';
              const cls = result === 'PASS' ? 'pass' : result === 'FAIL' ? 'fail' : '';
              return `<td><select class="${cls}" onchange="updateTestResult('${g.id}', '${emu.id}', this.value); this.className = this.value === 'PASS' ? 'pass' : this.value === 'FAIL' ? 'fail' : '';">
                <option value="-" ${result === '-' ? 'selected' : ''}>-</option>
                <option value="PASS" ${result === 'PASS' ? 'selected' : ''}>PASS</option>
                <option value="FAIL" ${result === 'FAIL' ? 'selected' : ''}>FAIL</option>
                <option value="N/T" ${result === 'N/T' ? 'selected' : ''}>N/T</option>
              </select></td>`;
            }).join('')}
          </tr>
        `;
      }).join('');
    }

    function addGame() {
      const name = document.getElementById('newGameName');
      const version = document.getElementById('newGameVersion');
      if (!name.value.trim()) return;
      games.push({ id: `game_${Date.now()}`, name: name.value.trim(), version: version.value.trim(), results: {} });
      name.value = ''; version.value = '';
      render();
    }

    function removeGame(id) { games = games.filter(g => g.id !== id); render(); }
    function updateGame(id, field, value) { games = games.map(g => g.id === id ? { ...g, [field]: value } : g); renderTable(); }
    function updateTestResult(gid, eid, result) { games = games.map(g => g.id === gid ? { ...g, results: { ...g.results, [eid]: result } } : g); }
    function updateVersion(id, field, value) { versions[id] = { ...versions[id], [field]: value }; render(); }

    function togglePreview() {
      isPreviewMode = !isPreviewMode;
      document.getElementById('editMode').classList.toggle('hidden', isPreviewMode);
      document.getElementById('previewMode').classList.toggle('hidden', !isPreviewMode);
      document.getElementById('previewBtnText').textContent = isPreviewMode ? 'í¸ì§‘ ëª¨ë“œ' : 'ğŸ‘ï¸ ë¯¸ë¦¬ë³´ê¸°';
      if (isPreviewMode) document.getElementById('previewContent').innerHTML = generateHTML();
    }

    function generateHTML() {
      const reportDate = document.getElementById('reportDate').value;
      const noteText = document.getElementById('noteText').value;
      
      // Outlook ìŠ¤íƒ€ì¼ ë³€ìˆ˜
      const borderStyle = 'border: 1px solid rgb(171, 171, 171);';
      const headerBg = 'background-color: #FFF2CC;';
      const updateBg = 'background-color: #FFFF00;';
      const fontStyle = 'font-family: Aptos, Calibri, Helvetica, sans-serif; font-size: 12pt; color: rgb(0, 0, 0);';
      const cellStyle = `${borderStyle} padding: 8px; text-align: center; vertical-align: middle;`;
      
      const gameHeaders = games.map(g => 
        `<th style="${cellStyle} ${headerBg} ${fontStyle}">${g.name}[${g.version}]</th>`
      ).join('');

      const rows = EMULATORS.map(emu => {
        const ver = versions[emu.id] || { prevVersion: '-', latestVersion: '-' };
        const hasUpdate = ver.prevVersion !== '-' && ver.latestVersion !== '-' && ver.prevVersion !== ver.latestVersion;

        const gameResults = games.map(g => {
          const result = g.results[emu.id] || '-';
          const textStyle = result === 'FAIL' ? 'color: red;' : '';
          return `<td style="${cellStyle} ${fontStyle} ${textStyle}">${result}</td>`;
        }).join('');

        return `<tr>
            <td style="${cellStyle} ${fontStyle} ${hasUpdate ? updateBg : ''}">${emu.name}</td>
            <td style="${cellStyle} ${fontStyle}">${emu.android}</td>
            <td style="${cellStyle} ${fontStyle} ${hasUpdate ? updateBg : ''}">${ver.prevVersion}</td>
            <td style="${cellStyle} ${fontStyle} ${hasUpdate ? updateBg : ''}">${ver.latestVersion}</td>
            ${gameResults}
        </tr>`;
      }).join('\n');

      let html = `<div style="${fontStyle}">
<p>ì•ˆë…•í•˜ì„¸ìš” ê¸€ë¡œë²Œì‚¬ì—…ë¶€ QAíŒ€ ì •ê°€ì—°ì…ë‹ˆë‹¤.</p>
<p>${reportDate} ë‚ ì§œ ê¸°ì¤€ ìµœì‹  í…ŒìŠ¤íŠ¸ ì—ë®¬ë ˆì´í„° í™˜ê²½ ë° ê²°ê³¼ ê³µìœ ë“œë¦½ë‹ˆë‹¤.</p>
<br>
</div>
<table style="border-collapse: collapse;">
    <thead>
        <tr>
            <th style="${cellStyle} ${headerBg} ${fontStyle}">ì œí’ˆëª…</th>
            <th style="${cellStyle} ${headerBg} ${fontStyle}">Android ë²„ì „</th>
            <th style="${cellStyle} ${headerBg} ${fontStyle}">ì´ì „ ë²„ì „</th>
            <th style="${cellStyle} ${headerBg} ${fontStyle}">ìµœì‹  ë²„ì „</th>
            ${gameHeaders}
        </tr>
    </thead>
    <tbody>
${rows}
    </tbody>
</table>`;

      if (noteText.trim()) {
        // ì¤„ë°”ê¿ˆ ì²˜ë¦¬ ë° URL ë§í¬ ë³€í™˜
        const formattedNote = noteText
          .split('\n')
          .map(line => {
            // URLì„ ë§í¬ë¡œ ë³€í™˜
            return line.replace(/(https?:\/\/[^\s]+)/g, '<a href="$1">$1</a>');
          })
          .join('<br>');
        html += `<br><ul style="margin-top: 0; margin-bottom: 0;"><li style="${fontStyle}">
${formattedNote}
</li></ul>`;
      }
      return html;
    }

    async function copyToClipboard() {
      const html = generateHTML();
      const btn = document.getElementById('copyBtn');
      try {
        await navigator.clipboard.write([new ClipboardItem({
          'text/html': new Blob([html], { type: 'text/html' }),
          'text/plain': new Blob([html], { type: 'text/plain' }),
        })]);
      } catch { await navigator.clipboard.writeText(html); }
      btn.textContent = 'âœ“ ë³µì‚¬ë¨!';
      btn.classList.add('copied');
      setTimeout(() => { btn.textContent = 'HTML ë³µì‚¬'; btn.classList.remove('copied'); }, 2000);
    }

    document.addEventListener('keydown', (e) => {
      if (e.key === 'Enter' && (e.target.id === 'newGameName' || e.target.id === 'newGameVersion')) addGame();
    });

    init();
  </script>
</body>
</html>
